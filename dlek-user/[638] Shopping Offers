class Solution {
    private Map<String, Integer> memo = new HashMap<>();

    public int shoppingOffers(
            List<Integer> price,
            List<List<Integer>> special,
            List<Integer> needs
    ) {
        return dfs(price, special, needs);
    }

    private int dfs(
            List<Integer> price,
            List<List<Integer>> special,
            List<Integer> needs
    ) {

        String key = needs.toString();

        if (memo.containsKey(key)) {
            return memo.get(key);
        }

        int minCost = 0;
        for (int i = 0; i < needs.size(); i++) {
            minCost += needs.get(i) * price.get(i);
        }

        for (List<Integer> offer : special) {

            List<Integer> newNeeds = new ArrayList<>();
            boolean valid = true;

            for (int i = 0; i < needs.size(); i++) {

                int remain = needs.get(i) - offer.get(i);

                if (remain < 0) {
                    valid = false;
                    break;
                }

                newNeeds.add(remain);
            }

            if (valid) {

                int offerPrice = offer.get(offer.size() - 1);

                int totalCost = offerPrice + dfs(price, special, newNeeds);

                minCost = Math.min(minCost, totalCost);
            }
        }

        memo.put(key, minCost);

        return minCost;
    }
}
